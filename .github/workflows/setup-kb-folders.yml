name: Setup KB Folders

# Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ Ð¢ÐžÐ›Ð¬ÐšÐž Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ñ‡ÐµÑ€ÐµÐ· Ð²ÐµÐ±-Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ
on:
  workflow_dispatch:

jobs:
  setup-folders:
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: ðŸ—‚ï¸ Create missing folders and metadata
        run: |
          echo "ðŸš€ Creating Knowledge Base structure..."
          echo ""
          
          KB_DIR="app/knowledge_base"
          
          # Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð²ÑÐµÑ… ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹
          categories=(
            "B1_kros_urs_codes"
            "B2_csn_standards"
            "B3_current_prices"
            "B4_production_benchmarks"
            "B5_tech_cards"
            "B6_research_papers"
            "B7_regulations"
            "B8_company_specific"
          )
          
          # ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ñ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹
          declare -A descriptions=(
            ["B1_kros_urs_codes"]="KROS 4, ÃšRS, RTS codes database"
            ["B2_csn_standards"]="ÄŒSN standards and regulations"
            ["B3_current_prices"]="Current market prices"
            ["B4_production_benchmarks"]="Productivity benchmarks and historical projects"
            ["B5_tech_cards"]="Technical cards and procedures"
            ["B6_research_papers"]="Research papers and diploma theses"
            ["B7_regulations"]="Laws and building regulations"
            ["B8_company_specific"]="Company-specific rules and templates"
          )
          
          for category in "${categories[@]}"; do
            category_path="$KB_DIR/$category"
            
            # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ð°Ð¿ÐºÑƒ ÐµÑÐ»Ð¸ Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚
            if [ ! -d "$category_path" ]; then
              mkdir -p "$category_path"
              echo "ðŸ“ Created folder: $category"
            else
              echo "âœ… Folder exists: $category"
            fi
            
            # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ metadata.json ÐµÑÐ»Ð¸ Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚
            if [ ! -f "$category_path/metadata.json" ]; then
              cat > "$category_path/metadata.json" << EOF
          {
            "category": "$category",
            "last_updated": "$(date +%Y-%m-%d)",
            "version": "1.0",
            "source": "Initial setup",
            "description": "${descriptions[$category]}",
            "files": [],
            "notes": "Category initialized. Ready for data."
          }
          EOF
              echo "   âœ… Created metadata.json"
            else
              echo "   â„¹ï¸  metadata.json already exists"
            fi
            
            # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ .gitkeep Ð´Ð»Ñ Ð¿ÑƒÑÑ‚Ñ‹Ñ… Ð¿Ð°Ð¿Ð¾Ðº
            if [ ! -f "$category_path/.gitkeep" ]; then
              touch "$category_path/.gitkeep"
              echo "   âœ… Created .gitkeep"
            fi
            
            echo ""
          done
          
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ¨ Knowledge Base structure created!"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ðŸ“Š Summary:"
          for category in "${categories[@]}"; do
            if [ -d "$KB_DIR/$category" ]; then
              file_count=$(find "$KB_DIR/$category" -type f \
                ! -name "metadata.json" \
                ! -name ".gitkeep" 2>/dev/null | wc -l)
              echo "  âœ… $category ($file_count files)"
            fi
          done
      
      - name: ðŸ’¾ Commit and push changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÐµÑÑ‚ÑŒ Ð»Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ
          if [ -n "$(git status --porcelain)" ]; then
            git add app/knowledge_base/
            git commit -m "ðŸ—‚ï¸ Initialize Knowledge Base structure

          - Created all B1-B8 category folders
          - Added metadata.json to each category
          - Added .gitkeep for Git tracking
          
          Auto-generated by GitHub Actions"
            
            git push
            
            echo ""
            echo "âœ… Changes committed and pushed successfully!"
          else
            echo ""
            echo "â„¹ï¸  No changes to commit - structure already exists"
          fi
      
      - name: ðŸ“‹ Create summary
        run: |
          echo "## ðŸ“‚ Knowledge Base Setup Complete" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… All category folders have been created with initial metadata.json" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“Š Structure:" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Category | Description | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|----------|-------------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| B1_kros_urs_codes | KROS 4, ÃšRS, RTS codes | âœ… Ready |" >> $GITHUB_STEP_SUMMARY
          echo "| B2_csn_standards | ÄŒSN standards | âœ… Ready |" >> $GITHUB_STEP_SUMMARY
          echo "| B3_current_prices | Market prices | âœ… Ready |" >> $GITHUB_STEP_SUMMARY
          echo "| B4_production_benchmarks | Benchmarks | âœ… Ready |" >> $GITHUB_STEP_SUMMARY
          echo "| B5_tech_cards | Technical cards | âœ… Ready |" >> $GITHUB_STEP_SUMMARY
          echo "| B6_research_papers | Research | âœ… Ready |" >> $GITHUB_STEP_SUMMARY
          echo "| B7_regulations | Regulations | âœ… Ready |" >> $GITHUB_STEP_SUMMARY
          echo "| B8_company_specific | Company rules | âœ… Ready |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸš€ Next steps:" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "1. Start adding files to each category" >> $GITHUB_STEP_SUMMARY
          echo "2. Files will be automatically tracked" >> $GITHUB_STEP_SUMMARY
          echo "3. metadata.json will auto-update (if you setup the update workflow)" >> $GITHUB_STEP_SUMMARY
