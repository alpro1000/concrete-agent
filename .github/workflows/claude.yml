name: Claude Helper

on:
  issue_comment:
    types: [created]

jobs:
  help:
    if: contains(github.event.comment.body, '@claude')
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Simple Analysis
        run: |
          echo "🤖 Claude анализирует проект..."
          
          # Проверяем структуру
          if [ -d "agents" ]; then
            echo "✅ Папка agents найдена"
          else
            echo "❌ Папка agents отсутствует"
            mkdir -p agents
            echo "📁 Создана папка agents"
          fi
          
          # Создаём базовый README если нужно
          if [ ! -f "README.md" ]; then
            cat > README.md << 'EOF'
          # Czech Construction Management System
          
          Система управления строительными проектами для Чехии.
          
          ## Структура:
          - `agents/` - Специализированные агенты
          - `config/` - Конфигурационные файлы  
          - `utils/` - Утилиты и вспомогательные функции
          
          ## Стандарты:
          - Бетон: ČSN EN 206+A2
          - Сталь: ČSN EN 10025
          - Теплотехника: ČSN 73 0540
          
          Используйте `@claude` в Issues для получения помощи.
          EOF
            echo "📄 Создан README.md"
          fi

      - name: Comment
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `🤖 **Claude Assistant отвечает:**
              
              Привет! Я проанализировал проект. 
              
              Запрос: "${context.payload.comment.body}"
              
              ✅ Базовая проверка выполнена
              📁 Структура проекта проверена
              
              Что я могу помочь:
              - \`@claude анализ кода\` - проверка кода
              - \`@claude создай структуру\` - базовая структура
              - \`@claude помощь с бетоном\` - стандарты ČSN EN 206
              
              ---
              *Claude Assistant для строительных проектов* 🏗️`
            });
