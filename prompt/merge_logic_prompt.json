{
  "prompt_name": "merge_logic",
  "description": "Правила объединения результатов анализа разных агентов (бетон, материалы, сметы, сравнение версий).",
  "merge_strategy": {
    "concrete_agent": {
      "priority": 1,
      "merge_fields": ["grade", "environment_classes", "used_in", "smeta_mentions"]
    },
    "materials_agent": {
      "priority": 2,
      "merge_fields": ["category", "found_terms", "total_mentions"]
    },
    "smetny_inzenyr": {
      "priority": 3,
      "merge_fields": ["document_name", "positions", "resources"]
    },
    "version_diff_agent": {
      "priority": 4,
      "merge_fields": ["document_diff", "smeta_diff"]
    }
  },
  "conflict_resolution": {
    "strategy": "prefer_concrete_agent",
    "rules": [
      "Если бетонные марки найдены и в doc_parser, и в Claude — оставляем версию Claude, но добавляем ссылки из doc_parser.",
      "Если один и тот же материал встречается в нескольких документах — суммируем количество упоминаний.",
      "Если есть противоречия в смете, добавляем все версии и отмечаем как 'conflict'."
    ]
  },
  "output_format": {
    "summary": {
      "concrete": "Список марок бетона с контекстом применения и сметными ссылками",
      "materials": "Классифицированные материалы с количеством упоминаний",
      "smeta": "Объединённые строки сметы",
      "diff": "Изменения в документации или смете"
    },
    "final_report": "JSON, пригодный для выгрузки в BI-систему или Excel"
  },
  "notes": "Этот промт используется агентом merge_parser для объединения частичных результатов. Все данные приводятся в единую структуру JSON, конфликты явно помечаются."
}
