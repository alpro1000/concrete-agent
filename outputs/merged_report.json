import json
import os
import logging

def save_merged_report(data: dict, output_path: str = "outputs/merged_report.json") -> str:
    """
    Сохраняет итоговый JSON-отчёт в файл.

    :param data: Словарь с объединёнными результатами анализа
    :param output_path: Путь до выходного файла
    :return: Путь до сохранённого файла
    """
    os.makedirs(os.path.dirname(output_path), exist_ok=True)

    try:
        with open(output_path, "w", encoding="utf-8") as f:
            json.dump(data, f, indent=2, ensure_ascii=False)
        logging.info(f"✅ Итоговый отчёт сохранён: {output_path}")
        return output_path
    except Exception as e:
        logging.error(f"❌ Ошибка при сохранении JSON-отчёта: {e}")
        raise
